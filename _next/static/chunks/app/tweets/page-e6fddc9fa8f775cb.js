(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{9350:(e,t,r)=>{Promise.resolve().then(r.bind(r,2647)),Promise.resolve().then(r.bind(r,850))},2647:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var s=r(5155),a=r(7396),l=r(2115),n=r(767),o=r(6710),i=r(7113);function c(){let{theme:e,setTheme:t}=(0,i.D)(),[r,a]=l.useState(!1);return(l.useEffect(()=>{a(!0)},[]),r)?(0,s.jsxs)("button",{onClick:()=>t("dark"===e?"light":"dark"),className:"p-2 transition-transform hover:scale-110 active:scale-95","aria-label":"Toggle theme",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full border border-[var(--accent)] transition-transform duration-500 ".concat("dark"===e?"rotate-180":"rotate-0"),style:{background:"linear-gradient(90deg, var(--accent) 50%, #ffffff 50%)"}}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]}):(0,s.jsxs)("button",{className:"p-2 transition-opacity hover:opacity-80","aria-label":"Toggle theme",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full border border-[var(--accent)]",style:{background:"linear-gradient(90deg, var(--accent) 50%, #ffffff 50%)"}}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}function d(e){let{className:t="max-w-6xl mx-auto px-6"}=e,[r,i]=(0,l.useState)(!1);return(0,l.useEffect)(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[r]),(0,s.jsxs)("header",{className:"py-8 mb-12",children:[(0,s.jsxs)("div",{className:"".concat(t," flex justify-between items-center relative z-50"),children:[(0,s.jsx)(a.default,{href:"/",className:"text-accent font-extrabold text-2xl tracking-tight hover:opacity-80 transition-opacity",onClick:()=>i(!1),children:"AlpacaNotes"}),(0,s.jsxs)("nav",{className:"hidden md:flex items-center gap-8 text-base font-semibold text-muted",children:[(0,s.jsx)(a.default,{href:"/articles",className:"hover:text-foreground transition-colors",children:"Articles"}),(0,s.jsx)(a.default,{href:"/notes",className:"hover:text-foreground transition-colors",children:"Notes"}),(0,s.jsx)(a.default,{href:"/tweets",className:"hover:text-foreground transition-colors",children:"Tweets"}),(0,s.jsx)(a.default,{href:"/topics",className:"hover:text-foreground transition-colors",children:"Topics"}),(0,s.jsx)(a.default,{href:"/rss.xml",prefetch:!1,className:"hover:text-foreground transition-colors",children:"RSS"}),(0,s.jsx)("div",{className:"pl-6 border-l border-border-subtle flex items-center",children:(0,s.jsx)(c,{})})]}),(0,s.jsxs)("div",{className:"md:hidden flex items-center gap-4",children:[(0,s.jsx)(c,{}),(0,s.jsx)("button",{className:"text-muted hover:text-foreground transition-colors p-2 -mr-2",onClick:()=>i(!r),"aria-label":"Toggle menu",children:r?(0,s.jsx)(n.A,{size:24}):(0,s.jsx)(o.A,{size:24})})]})]}),r&&(0,s.jsx)("div",{className:"fixed inset-0 bg-background z-40 md:hidden pt-32 px-6 animate-in fade-in duration-200",children:(0,s.jsxs)("nav",{className:"flex flex-col gap-6 text-xl font-medium text-muted",children:[(0,s.jsx)(a.default,{href:"/articles",className:"hover:text-foreground transition-colors py-2",onClick:()=>i(!1),children:"Articles"}),(0,s.jsx)(a.default,{href:"/notes",className:"hover:text-foreground transition-colors py-2",onClick:()=>i(!1),children:"Notes"}),(0,s.jsx)(a.default,{href:"/tweets",className:"hover:text-foreground transition-colors py-2",onClick:()=>i(!1),children:"Tweets"}),(0,s.jsx)(a.default,{href:"/topics",className:"hover:text-foreground transition-colors py-2",onClick:()=>i(!1),children:"Topics"}),(0,s.jsx)(a.default,{href:"/rss.xml",prefetch:!1,className:"hover:text-foreground transition-colors py-2",onClick:()=>i(!1),children:"RSS"}),(0,s.jsxs)("div",{className:"pt-8 mt-4 border-t border-border-subtle",children:[(0,s.jsx)("p",{className:"mb-4 text-base text-muted",children:"Subscribe"}),(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsx)("input",{type:"email",placeholder:"Email",className:"bg-surface-soft border border-border-subtle rounded-l px-4 py-3 w-full focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent text-sm"}),(0,s.jsx)("button",{className:"bg-accent text-white px-6 py-3 rounded-r font-bold hover:opacity-90 text-sm whitespace-nowrap",children:"Subscribe"})]})]})]})})]})}},850:(e,t,r)=>{"use strict";r.d(t,{default:()=>j});var s=r(5155),a=r(2115),l=r(76),n=r(7280),o=r(9191),i=r(9271),c=r(590),d=r(591),u=r(3950),m=r(5765),x=r(767);function h(e){let{tweet:t}=e,[r,h]=(0,a.useState)(!1),[f,p]=(0,a.useState)(""),b=e=>{p(e),h(!0),document.body.style.overflow="hidden"},v=()=>{h(!1),document.body.style.overflow="auto"},g=e=>e?e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString():"0",w="https://twitter.com/".concat(t.author.username,"/status/").concat(t.id);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{id:"tweet-".concat(t.id),className:"flex gap-4 p-6 border-b border-border-subtle hover:bg-surface-soft transition-colors",children:[(0,s.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,s.jsx)("img",{src:t.author.profile_image_url,alt:t.author.name,className:"w-10 h-10 rounded-full"})}),(0,s.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,s.jsx)("div",{className:"flex items-center justify-between gap-2 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[(0,s.jsx)("span",{className:"font-bold text-foreground truncate",children:t.author.name}),t.author.verified&&(0,s.jsx)("span",{className:"text-accent text-xs",children:"✓"}),(0,s.jsxs)("span",{className:"text-muted truncate",children:["@",t.author.username]}),(0,s.jsx)("span",{className:"text-muted",children:"\xb7"}),(0,s.jsx)("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"text-muted hover:text-foreground hover:underline whitespace-nowrap",suppressHydrationWarning:!0,children:(e=>{let t=new Date(e),r=new Date;return r.getTime()-t.getTime()<864e5?(0,l.m)(t,{addSuffix:!0}).replace("about ",""):t.getFullYear()!==r.getFullYear()?(0,n.GP)(t,"MMM d, yyyy"):(0,n.GP)(t,"MMM d")})(t.created_at)})]})}),(0,s.jsx)("div",{className:"text-[15px] leading-relaxed text-foreground whitespace-pre-wrap break-words",dangerouslySetInnerHTML:(()=>{var e;let r=t.text,s=(null===(e=t.entities)||void 0===e?void 0:e.urls)||[];return s.length>0&&s.forEach(e=>{if(!e.url)return;let t=RegExp(e.url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(t,"")}),t.media&&t.media.length>0&&(r=r.replace(/\s*https:\/\/t\.co\/[a-zA-Z0-9]+$/,"")),{__html:r=(r=(r=(r=r.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" class="text-accent hover:underline">$1</a>')).replace(/(@\w+)/g,'<span class="text-accent">$1</span>')).replace(/^[\s\u3000]+/,"")).replace(/\n/g,"<br>")}})()}),(()=>{let e;if(!t.media||0===t.media.length)return null;if(1===t.media.length){let r=t.media[0];"photo"===r.type?e=(0,s.jsx)("img",{src:r.url,alt:"Tweet media",className:"w-full h-auto object-cover max-h-[500px] cursor-zoom-in rounded-xl border border-border-subtle",onClick:()=>b(r.url||"")}):("video"===r.type||"animated_gif"===r.type)&&(e=(0,s.jsxs)("div",{className:"relative cursor-pointer rounded-xl overflow-hidden border border-border-subtle",onClick:()=>b(r.preview_image_url||""),children:[(0,s.jsx)("img",{src:r.preview_image_url,className:"w-full h-auto object-cover",alt:"Video preview"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 hover:bg-black/40 transition-colors",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-accent rounded-full flex items-center justify-center text-white",children:(0,s.jsx)(o.A,{size:20,fill:"currentColor"})})})]}))}else e=(0,s.jsx)("div",{className:"grid grid-cols-2 gap-0.5 rounded-xl overflow-hidden border border-border-subtle",children:t.media.map((e,t)=>{let r=e.url||e.preview_image_url||"";return(0,s.jsx)("div",{className:"relative aspect-square overflow-hidden bg-black cursor-zoom-in",onClick:()=>b(r),children:(0,s.jsx)("img",{src:r,className:"w-full h-full object-cover hover:opacity-90 transition-opacity",alt:"Media ".concat(t+1)})},t)})});return(0,s.jsx)("div",{className:"mt-3",children:e})})(),(()=>{var e;let r=(null===(e=t.entities)||void 0===e?void 0:e.urls)||[];return 0===r.length?null:(0,s.jsx)("div",{className:"mt-3 space-y-3",children:r.map((e,t)=>{let r=e.expanded_url||e.url;if(!r)return null;let a=r.match(/https?:\/\/(?:twitter\.com|x\.com)\/([^/]+)\/status\/(\d+)/),l=e.display_url||r.replace(/^https?:\/\//,""),n="";try{n=new URL(r).hostname.replace(/^www\./,"")}catch(e){n=l.split("/")[0]}if(!a)return(0,s.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"block no-underline group",children:(0,s.jsx)("div",{className:"border border-border-subtle rounded-xl overflow-hidden hover:bg-surface-soft transition-colors",children:(0,s.jsxs)("div",{className:"px-4 py-3",children:[(0,s.jsx)("div",{className:"text-xs text-muted mb-1",children:n}),(0,s.jsx)("div",{className:"text-sm text-foreground truncate",children:l})]})})},t);{let e=a[1];return(0,s.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"block no-underline group",children:(0,s.jsx)("div",{className:"border border-border-subtle rounded-xl overflow-hidden hover:bg-surface-soft transition-colors",children:(0,s.jsxs)("div",{className:"px-4 py-3",children:[(0,s.jsxs)("div",{className:"text-xs text-muted mb-1",children:["引用推文 \xb7 ",n]}),(0,s.jsxs)("div",{className:"text-sm text-foreground truncate",children:["引用 @",e," 的推文"]})]})})},t)}})})})(),(0,s.jsxs)("div",{className:"flex justify-between mt-4 max-w-md text-muted text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer hover:text-accent",children:[(0,s.jsx)("div",{className:"p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors",children:(0,s.jsx)(i.A,{size:16})}),(0,s.jsx)("span",{children:g(t.metrics.reply_count)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer hover:text-green-500",children:[(0,s.jsx)("div",{className:"p-2 -m-2 rounded-full group-hover:bg-green-500/10 transition-colors",children:(0,s.jsx)(c.A,{size:16})}),(0,s.jsx)("span",{children:g(t.metrics.retweet_count)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer hover:text-pink-500",children:[(0,s.jsx)("div",{className:"p-2 -m-2 rounded-full group-hover:bg-pink-500/10 transition-colors",children:(0,s.jsx)(d.A,{size:16})}),(0,s.jsx)("span",{children:g(t.metrics.like_count)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 group cursor-pointer hover:text-accent",children:[(0,s.jsx)("div",{className:"p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors",children:(0,s.jsx)(u.A,{size:16})}),(0,s.jsx)("span",{children:g(t.metrics.view_count||t.metrics.impression_count||0)})]}),(0,s.jsx)("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 group cursor-pointer hover:text-accent",children:(0,s.jsx)("div",{className:"p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors",children:(0,s.jsx)(m.A,{size:16})})})]})]})]}),r&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",onClick:v,children:[(0,s.jsx)("button",{onClick:v,className:"absolute top-4 right-4 text-white/70 hover:text-white p-2",children:(0,s.jsx)(x.A,{size:32})}),(0,s.jsx)("img",{src:f,alt:"Full size",className:"max-w-full max-h-[90vh] object-contain",onClick:e=>e.stopPropagation()})]})]})}function f(e){let{data:t,onTweetClick:r,className:a="sticky top-24 max-h-[calc(100vh-8rem)]"}=e,l=e=>{if(e){if(r)r(e);else{let t=document.getElementById("tweet-".concat(e));t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}};return 0===t.length?null:(0,s.jsx)("div",{className:"".concat(a," overflow-y-auto pr-4 custom-scrollbar pb-10"),children:(0,s.jsx)("div",{className:"relative border-l border-border-subtle ml-3 pl-6 py-2",children:t.map(e=>(0,s.jsxs)("div",{className:"mb-8 relative",children:[(0,s.jsxs)("div",{className:"absolute -left-[29px] top-0 flex items-center",children:[(0,s.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-muted ring-4 ring-background"}),(0,s.jsx)("span",{className:"ml-3 text-[11px] font-bold text-muted uppercase tracking-widest whitespace-nowrap",children:e.monthLabel})]}),(0,s.jsx)("div",{className:"pt-6 flex flex-col gap-[2px]",children:e.days.map(e=>{let t=0===e.count,r=t?0:Math.min(e.count/100*100,100);return(0,s.jsx)("div",{className:"group flex items-center h-[2px] w-full ".concat(t?"":"cursor-pointer hover:h-[4px]"," transition-all duration-200"),title:t?e.dateLabel:"".concat(e.dateLabel,": ").concat(e.count," tweets"),onClick:()=>!t&&l(e.firstTweetId),children:t?(0,s.jsx)("div",{className:"h-[2px] w-full bg-transparent"}):(0,s.jsx)("div",{className:"bg-accent rounded-r-sm opacity-80 group-hover:opacity-100 transition-opacity",style:{width:"".concat(r,"%"),height:"100%",minWidth:"6px"}})},e.date)})})]},e.month))})})}var p=r(2423);let b=()=>{var e,t;let r=window.location.pathname.match(/^(.*)\/tweets(?:\/|$)/);if(r){let e=r[1];return e&&"/"!==e?e:""}let s=null!==(t=null===(e=window.__NEXT_DATA__)||void 0===e?void 0:e.assetPrefix)&&void 0!==t?t:"";return s?s.endsWith("/")?s.slice(0,-1):s:""},v=async e=>{let t=b(),r="".concat(t).concat(e),s=await fetch(r);if(!s.ok&&t){let t=await fetch(e);if(t.ok)return t.json()}if(!s.ok)throw Error("Failed to load ".concat(e,": ").concat(s.status));return s.json()},g=e=>{let t=window.requestIdleCallback;return t?t(e,{timeout:1500}):window.setTimeout(e,800)},w=e=>{let t=window.cancelIdleCallback;t?t(e):window.clearTimeout(e)};function j(e){let{timelineData:t}=e,[r,l]=(0,a.useState)([]),[n,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(!1),[m,b]=(0,a.useState)(null),[j,N]=(0,a.useState)(0),[y,k]=(0,a.useState)(!1),_=(0,a.useRef)(new Set),C=(0,a.useRef)(new Set),S=(0,a.useRef)(new Set),T=(0,a.useRef)([]),E=(0,a.useRef)(0),z=(0,a.useRef)(null),A=(0,a.useRef)(!1);(0,a.useEffect)(()=>{T.current=r},[r]),(0,a.useEffect)(()=>{E.current=j},[j]);let P=(0,a.useCallback)(async e=>{if(_.current.has(e)||C.current.has(e))return[];C.current.add(e);try{let t=(await v("/tweets/pages/".concat(e,".json"))).filter(e=>!S.current.has(e.id));return t.forEach(e=>S.current.add(e.id)),_.current.add(e),N(t=>Math.max(t,e+1)),t.length>0&&l(e=>{let r=[...e,...t];return T.current=r,r}),t}finally{C.current.delete(e)}},[]);(0,a.useEffect)(()=>{let e=!0;return(async()=>{c(!0),b(null);try{let t=await v("/tweets/manifest.json");if(!e)return;o(t),await P(0)}catch(t){if(!e)return;b("无法加载推文数据，请确认已生成并部署 public/tweets/manifest.json。"),console.error("Failed to load tweets manifest:",t)}finally{e&&c(!1)}})(),()=>{e=!1}},[P]),(0,a.useEffect)(()=>{if(!n||i)return;A.current=!0;let e=async()=>{if(!A.current||!n)return;let t=E.current;if(!(t>=n.totalPages)){try{await P(t)}catch(e){console.warn("Prefetch tweets failed:",e)}A.current&&!(E.current>=n.totalPages)&&(z.current=g(e))}};return(async()=>{for(let e=0;e<2;e+=1){if(!A.current||!n)return;let e=E.current;if(e>=n.totalPages)return;try{await P(e)}catch(e){console.warn("Prefetch tweets failed:",e);break}}A.current&&!(E.current>=n.totalPages)&&(z.current=g(e))})(),()=>{A.current=!1,null!==z.current&&w(z.current)}},[n,i,P]);let R=!!n&&j<n.totalPages;(0,a.useEffect)(()=>{let e=()=>{n&&!d&&!i&&R&&window.innerHeight+window.scrollY>=document.body.offsetHeight-1e3&&(u(!0),P(j).catch(e=>{console.error("Failed to load more tweets:",e),b("推文加载失败，请稍后重试。")}).finally(()=>u(!1)))};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[n,d,i,R,j,P]),(0,a.useEffect)(()=>(y&&window.innerWidth<1024?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[y]);let M=(0,a.useCallback)(async e=>{if(n&&!d&&!T.current.some(t=>t.id===e)){u(!0);try{let t=j;for(;t<n.totalPages&&(await P(t),!T.current.some(t=>t.id===e));)t+=1}finally{u(!1)}}},[n,d,j,P]),F=async e=>{window.innerWidth<1024&&k(!1);let t=T.current.findIndex(t=>t.id===e);-1===t&&(await M(e),t=T.current.findIndex(t=>t.id===e)),-1!==t&&setTimeout(()=>{let t=document.getElementById("tweet-".concat(e));if(t){let e=t.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:e,behavior:"smooth"}),t.classList.add("bg-[var(--surface-soft)]"),setTimeout(()=>{t.classList.remove("bg-[var(--surface-soft)]")},2e3)}},100)};return(0,s.jsxs)("div",{className:"flex gap-12 relative",children:[(0,s.jsx)("div",{className:"flex-grow min-w-0",children:(0,s.jsxs)("div",{className:"border border-[var(--border-subtle)] rounded-xl bg-[var(--surface)] overflow-hidden",children:[r.map(e=>(0,s.jsx)(h,{tweet:e},e.id)),m&&(0,s.jsx)("div",{className:"p-6 text-center text-sm text-red-500",children:m}),i&&(0,s.jsx)("div",{className:"p-12 text-center text-[var(--text-muted)]",children:"正在加载推文..."}),!i&&!m&&0===r.length&&(0,s.jsx)("div",{className:"p-12 text-center text-[var(--text-muted)]",children:"No tweets found. Please check the data directory."}),R&&d&&(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("div",{className:"inline-block w-6 h-6 border-2 border-[var(--border-subtle)] border-t-[var(--accent)] rounded-full animate-spin"})})]})}),(0,s.jsx)("button",{onClick:()=>k(!0),className:"fixed bottom-8 right-8 z-40 bg-accent text-white p-4 rounded-full shadow-lg hover:opacity-90 transition-all duration-300 transform ".concat(y?"translate-x-32 opacity-0":"translate-x-0 opacity-100"),"aria-label":"Open timeline",children:(0,s.jsx)(p.A,{size:24})}),y&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200 lg:hidden pointer-events-auto",onClick:()=>k(!1)}),(0,s.jsxs)("div",{className:"absolute right-0 top-0 bottom-0 w-[300px] bg-surface border-l border-border-subtle p-6 animate-in slide-in-from-right duration-300 flex flex-col shadow-2xl pointer-events-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"Timeline"}),(0,s.jsx)("button",{onClick:()=>k(!1),className:"text-muted hover:text-foreground",children:(0,s.jsx)(x.A,{size:24})})]}),(0,s.jsx)("div",{className:"flex-grow overflow-hidden",children:(0,s.jsx)(f,{data:t,onTweetClick:F,className:"h-full overflow-y-auto"})})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[935,721,441,517,358],()=>t(9350)),_N_E=e.O()}]);